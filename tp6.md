TP6 : Un LAN maîtrisé meo ?

Serveur DNS 
🌞 Dans le rendu, je veux un cat des 3 fichiers de conf (fichier principal + deux fichiers de zone)

``````
[abatm@dns ~]$ sudo cat /etc/named.conf
[sudo] password for abatm:

options {
        listen-on port 51 { 127.0.0.1; any; };
        listen-on-v6 port 51 { ::1; };
        directory       "/var/named";
        dump-file       "/var/named/data/cache_dump.db";
        statistics-file "/var/named/data/named_stats.txt";
        memstatistics-file "/var/named/data/named_mem_stats.txt";
        secroots-file   "/var/named/data/named.secroots";
        recursing-file  "/var/named/data/named.recursing";
        allow-query     { localhost; any; };
        allow-query-cache { localhost; any; };

        recursion yes;

        dnssec-validation yes;

        managed-keys-directory "/var/named/dynamic";
        geoip-directory "/usr/share/GeoIP";

        pid-file "/run/named/named.pid";
        session-keyfile "/run/named/session.key";

        /* https://fedoraproject.org/wiki/Changes/CryptoPolicy */
        include "/etc/crypto-policies/back-ends/bind.config";
};

logging {
        channel default_debug {
                file "data/named.run";
                severity dynamic;
        };
};

zone "." IN {
        type hint;
        file "named.ca";
};

include "/etc/named.rfc1912.zones";
include "/etc/named.root.key";

# référence vers notre fichier de zone
zone "tp6.b1" IN {
     type master;
     file "tp6.b1.db";
     allow-update { none; };
     allow-query {any; };
};
# référence vers notre fichier de zone inverse
zone "1.4.10.in-addr.arpa" IN {
     type master;
     file "tp6.b1.rev";
     allow-update { none; };
     allow-query { any; };
};
``````

``````
[abatm@dns ~]$ sudo cat /var/named/tp6.b1.db
$TTL 86400
@ IN SOA dns.tp6.b1. admin.tp6.b1. (
    2018052900 ;Serial
    3200 ;Refresh
    2000 ;Retry
    606400 ;Expire
    84600 ;Minimum TTL
)

; Infos sur le serveur DNS lui même (NS = NameServer)
@ IN NS dns.tp6.b1.

; Enregistrements DNS pour faire correspondre des noms à des IPs
dns       IN A 10.6.1.11
john      IN A 10.6.1.101
``````
``````
[abatm@dns ~]$ sudo cat /var/named/tp6.b1.rev
$TTL 84600
@ IN SOA dns.tp6.b1. admin.tp6.b1. (
    2018052900 ;Serial
    3200 ;Refresh
    2000 ;Retry
    606400 ;Expire
    84600 ;Minimum TTL
)

; Infos sur le serveur DNS lui même (NS = NameServer)
@ IN NS dns.tp6.b1.

; Reverse lookup
101 IN PTR dns.tp6.b1.
11 IN PTR john.tp6.b1.
``````
- un systemctl status named qui prouve que le service tourne bien
``````
[abatm@dns ~]$ sudo systemctl status named
● named.service - Berkeley Internet Name Domain (DNS)
     Loaded: loaded (/usr/lib/systemd/system/named.service; enabled; preset>
     Active: active (running) since Fri 2023-11-17 15:31:07 CET; 31min ago
     )
``````
- une commande ss qui prouve que le service écoute bien sur un port
``````
[abatm@dns ~]$ ss -l -n -t
State   Recv-Q  Send-Q   Local Address:Port     Peer Address:Port  Process
LISTEN  0       10           127.0.0.1:53            0.0.0.0:*
LISTEN  0       10          10.6.1.101:53            0.0.0.0:*
LISTEN  0       10               [::1]:53               [::]:*
``````
🌞 Ouvrez le bon port dans le firewall

- ouvrez le port 53 sur le firewall de dns.tp6.b1

``````
[abatm@dns ~]$ sudo firewall-cmd --add-port=53/udp --permanent
success
[abatm@dns ~]$ sudo firewall-cmd --reload
success
``````
TEST
🌞 Sur la machine john.tp6.b1

- Configuration
``````
[abatm@john ~]$ sudo cat /etc/resolv.conf
[sudo] password for abatm:
# Generated by NetworkManager
nameserver 10.6.1.101
``````
- Tests
``````
[abatm@john ~]$ ping google.com
PING google.com (142.250.201.174) 56(84) bytes of data.
64 bytes from par21s23-in-f14.1e100.net (142.250.201.174): icmp_seq=1 ttl=115 time=12.5 ms
64 bytes from par21s23-in-f14.1e100.net (142.250.201.174): icmp_seq=2 ttl=115 time=12.8 ms
64 bytes from par21s23-in-f14.1e100.net (142.250.201.174): icmp_seq=3 ttl=115 time=13.4 ms
^C
--- google.com ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2003ms
rtt min/avg/max/mdev = 12.518/12.917/13.425/0.378 ms
[abatm@john ~]$ ping dns.tp6.b1
PING dns.tp6.b1 (10.6.1.101) 56(84) bytes of data.
64 bytes from 10.6.1.101 (10.6.1.101): icmp_seq=1 ttl=64 time=0.140 ms
64 bytes from 10.6.1.101 (10.6.1.101): icmp_seq=2 ttl=64 time=0.326 ms
64 bytes from 10.6.1.101 (10.6.1.101): icmp_seq=3 ttl=64 time=0.330 ms
^C
--- dns.tp6.b1 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2028ms
rtt min/avg/max/mdev = 0.140/0.265/0.330/0.088 ms
``````
🌞 Sur votre PC
``````
PS C:\Windows\system32> Set-DNSClientServerAddress "Wi-Fi" -ServerAddresses ("10.6.1.101")
``````

``````
PS C:\Users\abatm> nslookup john.tp6.b1
Serveur :   UnKnown
Address:  10.6.1.101

Nom :    john.tp6.b1
Address:  10.6.1.11
``````
Serveur DHCP

🌞 Installer un serveur DHCP
``````
[abatm@dhcp ~]$ sudo dnf install dhcp-server -y
Complete !
``````
``````
[abatm@dhcp ~]$ sudo cat /etc/dhcp/dhcpd.conf
option domain-name     "srv.world";
option domain-name-servers     10.6.1.101;
default-lease-time 600;
max-lease-time 7200;
authoritative;
subnet 10.6.1.0 netmask 255.255.255.0 {
    range dynamic-bootp 10.6.1.13 10.6.1.37;
    option broadcast-address 10.6.1.255;
    option routers 10.6.1.254;
}
``````
``````
[abatm@dhcp ~]$ sudo systemctl enable --now dhcpd
``````
🌞 Test avec john.tp6.b1

- vous avez une IP dans la bonne range
``````
[abatm@john ~]$ ip a
2: enp0s3: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 08:00:27:7e:ba:fb brd ff:ff:ff:ff:ff:ff
    inet 10.6.1.13/24 brd 10.6.1.255 scope global dynamic noprefixroute enp0s3
       valid_lft 529sec preferred_lft 529sec
    inet6 fe80::a00:27ff:fe7e:bafb/64 scope link
       valid_lft forever preferred_lft forever
``````
- vous avez votre routeur configuré automatiquement comme passerelle
``````
[abatm@john ~]$ ip r s
default via 10.6.1.254 dev enp0s3 proto dhcp src 10.6.1.13 metric 100
10.6.1.0/24 dev enp0s3 proto kernel scope link src 10.6.1.13 metric 100
``````
- vous avez votre serveur DNS automatiquement configuré
``````
[abatm@john ~]$ sudo cat /etc/resolv.conf
# Generated by NetworkManager
search srv.world
nameserver 10.6.1.101
``````
- vous avez un accès internet
``````
[abatm@john ~]$ ping google.com
PING google.com (142.250.201.174) 56(84) bytes of data.
64 bytes from par21s23-in-f14.1e100.net (142.250.201.174): icmp_seq=1 ttl=115 time=11.8 ms
64 bytes from par21s23-in-f14.1e100.net (142.250.201.174): icmp_seq=2 ttl=115 time=12.2 ms
^C
--- google.com ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1002ms
rtt min/avg/max/mdev = 11.803/11.993/12.183/0.190 ms
``````
🌞 Requête web avec john.tp6.b1
``````
[abatm@john ~]$ curl www.ynov.com
``````